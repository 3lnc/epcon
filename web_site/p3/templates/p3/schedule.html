{% extends "p3/base.html" %}
{% load p3 conference assopy_tags %}

{% block EXTRA_HEAD %}
<link type="text/css" href="{{ STATIC_URL }}p5/s/schedule2.css" rel="stylesheet" />
<style>
/* layout */
.horizontal .hhmm { height: 20px; }
.horizontal.schedule { width: 3000px; }
.horizontal .track { position: relative; height: 75px; }
.horizontal .event.duration-15 { width: 50px; }
.horizontal .event.duration-30 { width: 100px; }
.horizontal .event.duration-45 { width: 150px; }
.horizontal .event.duration-60 { width: 200px; }
.horizontal .event.duration-75 { width: 250px; }
.horizontal .event.duration-90 { width: 300px; }
.horizontal .event.duration-240 { width: 800px; }
.horizontal .event.duration-480 { width: 1600px; }
.horizontal .time-0900 { left: 0; }
.horizontal .time-0930 { left: 100px; }
.horizontal .time-0945 { left: 150px; }
.horizontal .time-1030 { left: 300px; }
.horizontal .time-1115 { left: 450px; }
.horizontal .time-1215 { left: 650px; }
.horizontal .time-1300 { left: 800px; }
.horizontal .time-1315 { left: 850px; }
.horizontal .time-1430 { left: 1100px; }
.horizontal .time-1530 { left: 1300px; }
.horizontal .time-1630 { left: 1500px; }
.horizontal .time-1715 { left: 1650px; }
.horizontal .time-1815 { left: 1850px; }
.horizontal .time-1830 { left: 1900px; }
.horizontal .time-1930 { left: 2100px; }
.horizontal .event.tracks-1 { height: 75px; }
.horizontal .event.tracks-2 { height: 150px; }
.horizontal .event.tracks-3 { height: 225px; }
.horizontal .event.tracks-4 { height: 300px; }
.horizontal .event.tracks-5 { height: 375px; }
.horizontal .event.tracks-6 { height: 450px; }
.horizontal .event.tracks-7 { height: 525px; }
.horizontal .event.tracks-8 { height: 600px; }
.horizontal .track .title {
    position: absolute;
    left: -40px;
}

.vertical .hhmm {
    float: left;
    width: 40px;
    height: 735px;
}
.vertical.schedule { width: 1400px; }
.vertical.schedule:after {
    content: ' ';
    display: block;
    clear: both;
}
.vertical .track {
    position: relative;
    float: left;
    width: 190px;
    height: 735px;
}
.vertical .event {
    width: 100%;
}
.vertical .event.duration-15 { height: 15px; }
.vertical .event.duration-30 { height: 30px; }
.vertical .event.duration-45 { height: 45px; }
.vertical .event.duration-60 { height: 60px; }
.vertical .event.duration-75 { height: 75px; }
.vertical .event.duration-90 { height: 90px; }
.vertical .event.duration-240 { height: 240px; }
.vertical .event.duration-480 { height: 480px; }
.vertical .time-0900 { top: 15px; }
.vertical .time-0930 { top: 45px; }
.vertical .time-0945 { top: 60px; }
.vertical .time-1030 { top: 105px; }
.vertical .time-1115 { top: 150px; }
.vertical .time-1215 { top: 210px; }
.vertical .time-1300 { top: 255px; }
.vertical .time-1315 { top: 270px; }
.vertical .time-1430 { top: 345px; }
.vertical .time-1530 { top: 405px; }
.vertical .time-1630 { top: 465px; }
.vertical .time-1715 { top: 510px; }
.vertical .time-1815 { top: 570px; }
.vertical .time-1830 { top: 585px; }
.vertical .time-1930 { top: 645px; }
.vertical .event.tracks-1 { width: 190px; }
.vertical .event.tracks-2 { width: 380px; }
.vertical .event.tracks-3 { width: 570px; }
.vertical .event.tracks-4 { width: 760px; }
.vertical .event.tracks-5 { width: 950px; }
.vertical .event.tracks-6 { width: 1140px; }
.vertical .event.tracks-7 { width: 1330px; }
.vertical .event.tracks-8 { width: 1520px; }
.vertical .track .title {
    position: absolute;
    top: 0;
    text-align: center;
    width: 100%;
}

/* *********************** */

#schedule-navigator .close {
    position: absolute;
    right: 0;
}

.event .speakers {
    opacity: 0.7;
}
.event.exposed .speakers {
    opacity: 1;
}

#schedule-navigator {
    width: 250px;
    transform: translate(-105px, 0px) rotate(-90deg);
    -moz-transform: translate(-105px, 0px) rotate(-90deg);
    -webkit-transform: translate(-105px, 0px) rotate(-90deg);
    -o-transform: translate(-105px, 0px) rotate(-90deg);
    -ms-transform: translate(-105px, 0px) rotate(-90deg);
}

#schedule-navigator > div {
    padding: 0 10px !important;
    margin: 0;
    height: 40px;
}
</style>
{% endblock %}

{% block BODY_ID %}schedule{% endblock %}

{% block MAIN_CONTENT %}
<section class="notice">
Beta version, small changes could be introduced to meet speakers' necessities.
</section>
{% schedules_data sids as schedules %}
<nav id="schedule-navigator">
    <div>NAV</div>
    <div>
        <a href="#">Jump to</a>
        <div>
            <ul>
            {% for row in timetables %}
                {% with schedules|attrib_:forloop.counter0 as sdata %}
                <li><a href="#{{ sdata.slug }}">{{ sdata.date|date:"l, j F" }}</a></li>
                {% endwith %}
            {% endfor %}
            </ul>
        </div>
    </div>
    {% comment %}
    <div class="disabled">My schedule</div>
    {% endcomment %}
    <div>
        <a href="#">Filters</a>
        <div>
            <h3>Tracks</h3>
            <ul>
                <li><a href="#" class="track-toggle" data-tracks="track-ita">Italian track</a></li>
                <li><a href="#" class="track-toggle" data-tracks="training1,training2">Trainings</a></li>
                <li><a href="#" class="track-toggle" data-tracks="partner0,partner1">Partner program</a></li>
                <li><a href="#" class="track-toggle" data-tracks="sprint1,sprint2,sprint3">Sprint</a></li>
            </ul>
            <h3>Highlight</h3>
            <ul>
                <li><a href="#" class="highlight-chart">Using my votes</a></li>
            </ul>
        </div>
    </div>
</nav>

{% comment %}
<nav id="schedule-navigator">
    <div class="opener closed"> </div>
    <div class="content">
        <div class="wrapper">
            <h3>Search</h3>
            <form class="search">
                <input name="q" value="" />
            </form>
            <h3>Show</h3>
            <form class="show-flags" action="" method="get">
                <label class="active"><input type="hidden" name="show-track-ita" value="1" />Italian Track</label>
                <label class="active"><input type="hidden" name="show-training" value="1" />Trainings</label>
                <label class="active"><input type="hidden" name="show-partner-program" value="1" />Partner Program</label>
                <label class="active"><input type="hidden" name="show-sprint" value="1" />Sprint</label>
            </form>
            <h3>Jump to</h3>
            <ul class="jump-list">
                {% for schedule in schedules %}
                <li><a href="#{{ schedule.slug }}">{{ schedule.date|date:"l d" }}</a></li>
                {% endfor %}
            </ul>
            <div class="button mini" style="margin-top: 10px;">
                <a href="{% url p3-schedule-list conference=CONFERENCE %}">List view</a>
            </div>
            <div class="button mini" style="margin-top: 10px;">
                <a href="{% url p3-my-schedule %}">My schedule</a>
            </div>
            <div class="button mini" style="margin-top: 10px;">
                <a href="{% url p3-schedule-speakers conference=CONFERENCE %}">Speakers list</a>
            </div>
            <a class="trigger-overlay schedule-help" href="/schedule-help">How to use</a>
        </div>
    </div>
</nav>
{% endcomment %}
<div class="page clearfix">
    <div class="conference-schedules timetable vertical-narrow"  data-conference="{{ CONFERENCE }}">
    {% for sid, timet in timetables %}
        {% with schedules|attrib_:forloop.counter0 as sdata %}
        {% timetable_slice timet start="09:00" as tt %}
        <div id="{{ sdata.slug }}" class="schedule">
            <h2>{{ sdata.date|date:"l, j F Y" }}</h2>
            <div class="hhmm">
                <div>TRACK</div>
                {% for time_, events in tt.iterOnTimes %}
                {% with events|attrib_:"tags"|eval_:"set(sum(map(list, x), []))" as tlist %}
                {% comment %}Se gli eventi sono solo special non metto l'ora (Ã¨ ripetuta nel testo){% endcomment %}
                {% if tlist|length > 1 or "special" not in tlist %}
                <div class="time-{{ time_|time:"Hi" }}"><span>{{ time_|time:"H" }}</span>:{{ time_|time:"i" }}</div>
                {% endif %}
                {% endwith %}
                {% endfor %}
            </div>
            {% for track, events in tt.iterOnTracks %}
            <div class="track" data-track="{{ track }}">
                <div class="title">{{ sdata.tracks|attrib_:track|attrib_:"title"|safe }}</div>
                {% for e in events %}
                {% if e.tracks|length == 1 or e.tracks.0 == track %}
                <div id="e{{ e.id }}" class="event time-{{ e.time|time:"Hi" }} duration-{{ e.duration }} tracks-{{ e.tracks|length }} {{ e.tags|join:" " }}" data-id="{{ e.id }}"{% if e.talk %} data-talk="{{ e.talk.id }}"{% endif %}>
                    {% if e.talk %}
                    <div class="speakers">
                        <span class="maximized hhmm">{{ e.time|time:"H:i" }}</span>
                        {% for s in e.talk.speakers %}
                        <a href="{% url conference-profile slug=s.slug %}">{{ s.name|name_abbrv }}</a>{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </div>
                    <h3 class="name"><a href="{% url conference-talk slug=e.talk.slug %}">{{ e.name }}</a></h3>
                    <div class="talk-level {{ e.talk.level }}">&nbsp;<span class="maximized">{{ e.talk.level }}</span></div>
                    <div class="maximized all-tags">
                        {% for tag in e.talk.tags %}<a class="tag">{{ tag }}</a>{% endfor %}
                    </div>
                    <div class="maximized abstract cms"> </div>
                    {% else %}
                    <h3 class="name">
                        {% if "special" in e.tags %}
                        <div class="hhmm"><span>{{ e.time|time:"H" }}</span>:{{ e.time|time:"i" }}</div>
                        {% endif %}
                        {{ e.name|safe }}
                    </h3>
                    {% endif %}
                    <div class="tools">
                        {% comment %}
                        {% if ref in overbooked %}
                        <div class="room-full">
                            <img src="{{ STATIC_URL }}p5/i/warning.png" title="our estimate of attendance exceeds the room size" alt="warning" />
                        </div>
                        {% endif %}
                        {% endcomment %}
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% endfor %}
        </div>
        {% endwith %}
    {% endfor %}
    </div>
</div>
<script>
var STATIC_URL = {{ STATIC_URL|json_ }};
var user_authenticated = {{ request.user.is_authenticated|json_ }};
{% if request.user.is_authenticated %}
{% user_votes as votes %}
var user_votes = {{ votes|json_ }};
{% user_events_interest as einterests %}
var user_interest = {{ einterests|json_ }};
{% all_user_tickets as tickets %}
var user_tickets = {{ tickets|json_ }};
{% else %}
var user_votes = {};
var user_interest = {};
var user_tickets = [];
{% endif %}
</script>
<script src="{{ STATIC_URL }}p5/j/schedule.js" />
{% endblock %}

{% block SPONSORS %}
{% comment %}Omit sponsors col{% endcomment %}
{% endblock %}
