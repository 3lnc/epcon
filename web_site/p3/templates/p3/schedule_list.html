{% extends "p3/base.html" %}
{% load conference %}
{% block MAIN_CONTENT %}
<div class="cms">
    <h1>{% block CONTENT_TITLE %}Europython schedule{% endblock %}</h1>
    <div class="conference-schedules list"  data-conference="{{ CONFERENCE }}">
    {% schedules_data sids as schedules %}
    {% for sid, timet in timetables %}
        {% with schedules|attrib_:forloop.counter0 as sdata %}
        {% timetable_slice timet start="09:00" as tt %}
        <div id="{{ sdata.slug }}" class="schedule">
            <h2>{{ sdata.date|date:"l, j F Y" }}</h2>
            <table>
            {% for time_, events in tt.iterOnTimes %}
            {% for e in events %}
            <tr>
                {% if forloop.counter0 == 0 %}
                <th rowspan="{{ events|length }}">{{ time_|time:"H:i" }}</th>
                {% endif %}
                <td class="event"{% if e.talk %} data-talk="{{ e.talk.id }}"{% endif %}>
                    {% if e.talk %}
                    <div class="talk-level {{ e.talk.level }}">&nbsp;</div>
                    <a href="{% url conference-talk slug=e.talk.slug %}" class="trigger-overlay">{{ e.name }}</a>
                    by
                    <div class="speakers">
                        {% for s in e.talk.speakers %}
                        <a href="{% url conference-profile slug=s.slug %}">{{ s.name|name_abbrv }}</a>{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ e.name|safe }}
                    {% endif %}
                    in
                    <strong>
                        {% for t in e.tracks %}
                        <i>{{ sdata.tracks|attrib_:t|attrib_:"title"|safe }}</i>
                        {% endfor %}
                    </strong>
                </td>
            </tr>
            {% endfor %}
            {% endfor %}
            </table>
        </div>
        {% endwith %}
    {% endfor %}
    </div>
    {% comment %}
    {% regroup events|dictsort:"time" by event.schedule.date as grouped %}
    {% for data in grouped %}
    <h2>{{ data.grouper }}</h2>
    <ul class="schedule">
    {% for row in data.list %}
    {% with row.event as e %}
        {% if e.talk or e.custom != "&nbsp;" %}
        <li class="event">
            <strong>{{ e.start_time|time:"H:i" }}</strong> &mdash;
            {% if e.talk %}
            <div class="talk-level {{ e.talk.level }}">&nbsp;</div>
            {% with e|event_has_track:"teaser" as teaser %}
                <a
                    href="{% url conference-talk slug=e.talk.slug %}"
                    class="trigger-overlay"
                    {% if teaser %}
                    data-overlay-onload="$('#global-overlay h1').prepend('<a href=&quot;/training#teaser-talks&quot;>Teaser Talk:</a> ')"
                    {% endif %}>
                    {% if teaser %}[Teaser Talk] {% endif %}{{ e.talk.title }}</a>
                by
                {% for s in e.talk.get_all_speakers %}
                <a href="{% url conference-speaker slug=s.slug %}">{{ s.name|name_abbrv }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
                in
                <strong><i>{{ e.get_track.title|safe }}</i></strong>
                {% if e.talk %}
                    {% embed_video e.talk args="width=500,height=400" as h %}
                    {% if h %}
                    <a href="{% url conference-talk-video slug=e.talk.slug %}?torrent=1">BitTorrent</a>
                    {% endif %}
                {% endif %}
            {% endwith %}
            {% else %}
                <span class="custom-event">
                    {{ e.custom|safe }}
                </span>
            {% endif %}
        </li>
        {% endif %}
    {% endwith %}
    {% endfor %}
    </ul>
    {% endfor %}
    {% endcomment %}
</div>
{% endblock %}
