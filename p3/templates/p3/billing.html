{% extends "assopy/base.html" %}
{% load p3 assopy_tags i18n %}
{% block ASSOPY_MAIN_CONTENT %}
    <h1>Checkout</h1>
    <div class="cms span-9 last">
        <table>
            <col />
            <col />
            <col />
            <thead> 
                <tr> 
                    <th>Ticket</th> 
                    <th>Quantity</th> 
                    <th>Price</th> 
                </tr> 
            </thead>
            <tbody>
                {% for fare, quantity, price in tickets %}
                <tr>
                    <td>{{ fare.name }}</td>
                    <td>{{ quantity }}</td>
                    <td>€ {{ price|floatformat:"2" }}</td>
                </tr>
                {% endfor %}
                <tr class="subtotal"> 
                    <td colspan="2" style="text-align: right">Total</td>
                    <td>€ {{ total|floatformat:"2" }}</td> 
                </tr>
            </tbody>
        </table>
        <h2>Billing data</h2>
        {{ form.non_field_errors }}
        <form id="form-cart" action="{% url p3-billing %}" method="post">{% csrf_token %}
            <fieldset>
                <div class="span-6">{{ form.card_name|field }}</div>
                <div class="span-3 last">&nbsp;</div>
                <div class="span-6">{{ form.country|field }}</div>
                <div class="span-3 last">&nbsp;</div>
                <div class="span-3">{{ form.address|field }}</div>
                <div class="span-3">{{ form.city|field }}</div>
                <div class="span-3 last">{{ form.zip_code|field }}</div>
                <div class="span-6">{{ form.provincia|field }}</div>
                <div class="span-3 last">&nbsp;</div>
                <div class="span-3">{{ form.vat_number|field }}</div>
                <div class="span-3">{{ form.cf_number|field }}</div>
                <div class="span-3 last">&nbsp;</div>
            </fieldset>
            <fieldset class="border">
                <button type="submit">save</button>
            </fieldset>
        </form>
        <script type="text/javascript">
            function onCountryChanged(e) {
                var e = $(e);
                console.log(e.val());
                var it = e.val().toUpperCase() == 'IT';
                if(it) {
                    $('#id_cf_number').removeAttr('disabled');
                    $('#id_provincia').removeAttr('disabled');
                }
                else {
                    $('#id_cf_number').attr('disabled', true);
                    $('#id_provincia').attr('disabled', true);
                }
            }
            $('#id_country').change(function(e) { onCountryChanged(e.target); })
            onCountryChanged($('#id_country'));
        </script>
    </div>
{% endblock %}

