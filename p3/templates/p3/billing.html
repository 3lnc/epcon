{% extends "assopy/base.html" %}
{% load p3 assopy_tags i18n %}


{% block BODY_CLASS %}wizard{% endblock %}


{% block ASSOPY_MAIN_CONTENT %}
    <h1>Buy tickets (2 of 2)</h1>
   <div class="page-summary">
        <p>Review order and fill billing information.</p>    
    </div>
    
    <div class="span-9 last">
                
        <form id="form-cart" action="{% url p3-billing %}" method="post">{% csrf_token %}

            {{ form|form_errors }}

            <fieldset>

                <legend>Your order</legend>
                
                <div class="cms">
        
                    <table>
                        <col />
                        <col />
                        <col />
                        <thead> 
                            <tr> 
                                <th></th> 
                                <th>Q,ty</th> 
                                <th>Price</th> 
                            </tr> 
                        </thead>
                        <tbody>
                            {% for fare, quantity, price in tickets %}
                            <tr>
                                <td>{{ fare.name }}</td>
                                <td>{{ quantity }}</td>
                                <td>€ {{ price|floatformat:"2" }}</td>
                            </tr>
                            {% endfor %}
                            <tr>
                                <td>PyFiorentina</td>
                                <td>4</td>
                                <td>€ {{ 120|floatformat:"2" }}</td>
                            </tr>
                            <tr class="subtotal"> 
                                <td colspan="2" style="text-align: right">Total</td>
                                <td>€ {{ total|floatformat:"2" }}</td> 
                            </tr>
                        </tbody>
                    </table>
                <!-- /cms         -->
                </div>
            
            </fieldset>
            
            <fieldset>

                <legend>Billing data</legend>


                <div class="span-6">{{ form.card_name|field }}</div>
<!--                 <div class="span-3 last">&nbsp;</div> -->
                <div class="span-6">{{ form.country|field }}</div>
<!--                 <div class="span-3 last">&nbsp;</div> -->
                <div class="span-3">{{ form.address|field }}</div>
                <div class="span-3">{{ form.city|field }}</div>
                <div class="span-3 last">{{ form.zip_code|field }}</div>
                <div class="span-6">{{ form.provincia|field }}</div>
<!--                 <div class="span-3 last">&nbsp;</div> -->
                <div class="span-3">{{ form.vat_number|field }}</div>
                <div class="span-3">{{ form.cf_number|field }}</div>
<!--                 <div class="span-3 last">&nbsp;</div> -->
            </fieldset>
            <fieldset class="border">
                <button value="" name="" type="submit">Place Order &rarr;</button>
            </fieldset>
        </form>
        
        
        <script type="text/javascript">
            function onCountryChanged(e) {
                var e = $(e);
                console.log(e.val());
                var it = e.val().toUpperCase() == 'IT';
                if(it) {
                    $('#id_cf_number').removeAttr('disabled');
                    $('#id_provincia').removeAttr('disabled');
                }
                else {
                    $('#id_cf_number').attr('disabled', true);
                    $('#id_provincia').attr('disabled', true);
                }
            }
            $('#id_country').change(function(e) { onCountryChanged(e.target); })
            onCountryChanged($('#id_country'));
        </script>
    </div>
{% endblock %}

