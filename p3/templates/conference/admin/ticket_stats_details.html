{% extends "admin/base_site.html" %}
{% load p3 %}
{% block breadcrumbs %}
<div class="breadcrumbs">
     <a href="../../../">Home</a> &rsaquo;
     <a href="../../../">Conference</a> &rsaquo;
     <a href="../../">Tickets</a>&rsaquo;
     <a href="../">stats</a>&rsaquo;
     details
</div>
{% endblock %}{% block content %}
<h1>{{ stat.title }} (<a href="{% url admin:p3-ticket-stats-details-csv %}?code={{ stat.code }}&conference={{ conference }}">csv</a>)</h1>
{% paginate stat.details count=40 as page %}
<table>
    <tr>
        {% if request.GET.voyeur %}
        <th>&nbsp;</th>
        {% endif %}
        <th>attendee</th>
        <th>email</th>
        <th>buyer</th>
        <th>email</th>
        <th>order</th>
    </tr>
    {% for ticket in page.object_list %}
    <tr>
        {% if request.GET.voyeur %}
        <td>{% with ticket|ticket_user as u %}<img src="{{ u.photo_url }}" width="48" />{% endwith %}</td>
        {% endif %}
        <td>{{ ticket.name }}</td>
        <td>{{ ticket.p3_conference.assigned_to }}</td>
        <td>{{ ticket.orderitem.order.user.name }}</td>
        <td>{{ ticket.orderitem.order.user.user.email }}</td>
        <td>{{ ticket.orderitem.order.code }}</td>
    </tr>
    {% endfor %}
</table>
<div class="pagination">
    <span class="step-links">
        {% if page.has_previous %}
            <a href="?{% add_page_number_to_query page.previous_page_number %}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page.number }} of {{ page.paginator.num_pages }}.
        </span>

        {% if page.has_next %}
            <a href="?{% add_page_number_to_query page.next_page_number %}">next</a>
        {% endif %}
    </span>
</div>

{% if request.user.email %}
<hr />
<h1>Invia un email a tutti i partecipanti di questa lista</h1>
<form action="" method="POST">{% csrf_token %}
    <table>
        {{ form.as_table }}
    </table>
    <input type="submit" value="invia" />
</form>
<pre>
{% templatetag openblock %} load p3 %}           => load p3 template tag library
{% templatetag openvariable %} user }}              => assopy user instance
{% templatetag openvariable %} user.name }}         => full name (eg. Giovanni Bajo)
{% templatetag openvariable %} user|tickets_url }}  => URL to modify tickets (with sign-on token for users with autogenerated account) * require p3 library
</pre>
{% endif %}
{% endblock %}
