{% extends "p3/base.html" %}
{% load conference assopy_tags %}

{% block EXTRA_HEAD %}
    {{ block.super }}
    <style type="text/css">
        #form-options .inline .field {
            float: left;
        }
    </style>
{% endblock %}
{% block PAGE_TITLE %}Talk voting &mdash; {% endblock %}

{% block MAIN_CONTENT %}
    <h1>Talk Voting</h1>
    
    <div class="page-summary">        
        <p>{Summary} Loren Ipsum</p>
    </div>
    
    <form action="{% url conference-voting %}" method="GET" id="form-options">
        <div class="span-5 inline">
            {{ form.abstracts|field }}
            {{ form.talk_type|field }}
            {{ form.language|field }}
        </div>
        <div class="span-7 last inline">
            {{ form.order|field }}
            <div class="field">
                <label>&nbsp;</label>
                <input type="submit" value="refresh" />
            </div>
        </div>
    </form>
    <div class="span-8">
        <ul id="talk-voting">
            {% for t in talks %}
            <li>
                <h2>{{ forloop.counter }} - <a href="{% url conference-talk slug=t.slug %}">{{ t.title }}</a>{% if t.language == "it" %} <img src="{{ STATIC_URL }}p5/i/italian-flag.png" height="15" />{% endif %}</h2>
                <div class="meta">
                    By {% for s in t.get_all_speakers %}<a href="{% url conference-speaker slug=s.slug %}"><b>{{ s.name }}</b></a>{% if not forloop.last %}, {% endif %}{% endfor %}
                    | <b>{% if t.training_available %}Training{% else %}Talk{% endif %}</b>
                    for <b>{{ t.get_level_display }}</b>
                </div>
                <form action="{% url conference-voting %}" method="post">{% csrf_token %}
                    <input name="vote-{{ t.id }}" id="id_vote-{{ t.id }}" type="range" min="0" max="10" value="{{ t.user_vote.vote|default:"0" }}" step="0.5" />
                    <div class="rateit" data-rateit-backingfld="#id_vote-{{ t.id }}"></div>
                </form>
                <dl>
                    <dt rel="div[data-talk={{ t.id }}]" class="toggle" data-src="{% url conference-talk-xml t.slug %}">Abstract</dt>
                    <dd>
                        <div class="cms" data-talk="{{ t.id }}"> </div>                    
                    </dd>                    
                </dl>
            </li>
            {% endfor %}        
        </ul>
        <script type="text/javascript">
            (function() {
                function rate(e, val) {
                    var field = $(e.rateit('backingfld'));
                    var form = field.parents('form');
                    if(val == undefined) 
                        field.val(e.rateit('value'))
                    else
                        field.val(val);
                    form.ajaxSubmit();
                }
                $('#talk-voting .rateit')
                    .rateit()
                    .bind('rated', function() {
                        rate($(this));
                    })
                    .bind('reset', function() {
                        rate($(this), 0);
                    });
                $('#talk-voting .toggle').click(function(e) {
                    var trigger = $(e.target);
                    var dest = $(trigger.attr('rel'));
                    if(dest.attr('load'))
                        return;
                    dest.attr('load', '1');
                    dest.html('loading...');
                    $.ajax({
                        url: trigger.attr('data-src'),
                        dataType: 'xml',
                        success: function(data, text, jqXHR) {
                            dest.html($('talk abstract', data).html());
                        },
                        error: function(jqXHR, text, error) {
                            dest.attr('load', null);
                        }
                    });
                });
            })();
        </script>
    </div>
    
    <div class="span-4 last">
        <aside>    
            <div class="cms">
                <h4>Sample h4 header</h4>

                <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Etiam sit amet elit vitae arcu interdum ullamcorper. Nullam ultrices, nisi quis scelerisque convallis, augue neque tempor enim, et mattis justo nibh eu elit. Quisque ultrices gravida pede. Mauris accumsan vulputate tellus. Phasellus condimentum bibendum dolor. Mauris sed ipsum. Phasellus in diam. Nam sapien ligula, consectetuer id, hendrerit in, cursus sed, leo. Nam tincidunt rhoncus urna. Aliquam id massa ut nibh bibendum imperdiet. Curabitur neque mauris, porta vel, lacinia quis, placerat ultrices, orci.</p>
                
                
                <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Etiam sit amet elit vitae arcu interdum ullamcorper. Nullam ultrices, nisi quis scelerisque convallis, augue neque tempor enim, et mattis justo nibh eu elit. Quisque ultrices gravida pede. Mauris accumsan vulputate tellus. Phasellus condimentum bibendum dolor. Mauris sed ipsum. Phasellus in diam. Nam sapien ligula, consectetuer id, hendrerit in, cursus sed, leo. Nam tincidunt rhoncus urna. Aliquam id massa ut nibh bibendum imperdiet. Curabitur neque mauris, porta vel, lacinia quis, placerat ultrices, orci.</p>
                
            
            </div>
        
        </aside>
    </div>    
{% endblock %}
