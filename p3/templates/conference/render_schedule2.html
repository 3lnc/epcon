{% load conference %}

{% randint as r %}
{% timetable_cells timetable 70 60 70 61 as schedule_cells %}
<div id="s{{ r }}" class="schedule" style="{{ schedule_cells.1 }}">
    {% for cell in schedule_cells.0 %}
        {% if cell.type == '' %}
        <div class="cell track hhmm" style="{{ cell.size }}">&nbsp;</div>
        {% endif %}
        {% if cell.type == 'hhmm' %}
        <div
            class="cell hhmm"
            style="{{ cell.size }}"
            data-time="{{ cell.time|time:"H:i" }}">
            <span>{{ cell.time|time:"H" }}</span>:{{ cell.time|time:"i" }}
        </div>
        {% endif %}
        {% if cell.type == 'track' %}
        <div class="cell track" data-track="{{ cell.track }}" style="{{ cell.size }}">TRACK{{ forloop.counter }}</div>
        {% endif %}
        {% if cell.type == 'event' %}
            {% if not cell.event %}
            <div
                class="cell event empty"
                data-time="{{ cell.time|time:"H:i" }}"
                data-track="{{ cell.row }}"
                data-colspan="1"
                data-rowspan="1"
                style="{{ cell.size }}">&nbsp;</div>
            {% else %}
            {% with cell.event.ref as ref %}
            {% with ref|user_interest:request.user as interest %}
            <div
                class="cell event{% for t in ref.get_all_tracks_names %} t-{{ t }}{% endfor %}{% if interest > 0 %} highlighted{% endif %}{% if interest < 0 %} shadowed{% endif %}"
                data-time="{{ cell.time|time:"H:i" }}"
                data-track="{{ cell.row }}"
                {% if ref.talk %}data-duration="{{ ref.talk.duration }}"{% endif %}
                data-colspan="{{ cell.event.columns }}"
                data-rowspan="{{ cell.event.rows }}"
                data-event-url="{% url conference-schedule-event conference=schedule.conference slug=schedule.slug eid=ref.id %}"
                style="{{ cell.size }}">
                <div class="wrapper">
                {% if ref.talk %}
                    <div class="talk-level {{ ref.talk.level }}">&nbsp;</div>
                    <h3 data-talk="{{ ref.talk.id }}"><a href="{% url conference-talk slug=ref.talk.slug %}" title="{{ talk.title }}">{{ ref.talk.title|truncate_chars:50 }}</a></h3>
                    of 
                    {% for s in ref.talk.get_all_speakers %}
                    <a href="{% url conference-speaker slug=s.slug %}">{{ s.name }}</a>
                    {% endfor %}
                    {% comment %}
                    <div class="talk-vote">#{% talk_vote talk as x %}{{ x.vote}}</div>
                    <div class="talk-interest" data-url="{% url conference-schedule-event-interest conference=schedule.conference slug=schedule.slug eid=col.data.ref.id %}">
                        <button class="down {% if interest < 0 %}active{% endif %}">Down</button>
                        <button class="up {% if interest > 0 %}active{% endif %}">Up</button>
                    </div>
                    {% endcomment %}
                {% else %}
                    <div class="custom-event">{{ ref.custom|safe }}</div>
                {% endif %}
                </div>
            </div>
            {% endwith %}
            {% endwith %}
            {% endif %}
        {% endif %}
    {% endfor %}
</div>
